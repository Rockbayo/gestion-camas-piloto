{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="mb-4">Curva de Producción Interactiva: {{ variedad.variedad }}</h2>
    
    <div class="mb-3">
        <a href="{{ url_for('reportes.index') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver a Reportes
        </a>
        <a href="{{ url_for('reportes.curva_produccion', variedad_id=variedad.variedad_id) }}" class="btn btn-outline-primary ms-2">
            <i class="fas fa-chart-line"></i> Ver Versión Estática
        </a>
    </div>
    
    <!-- Guía de interpretación (puede ser colapsable) -->
    <div class="alert alert-info alert-dismissible fade show mb-3">
        <h5><i class="fas fa-info-circle"></i> ¿Cómo interpretar las curvas de producción?</h5>
        <p>Las curvas de producción muestran el comportamiento de cada variedad a lo largo del tiempo:</p>
        <ul>
            <li><strong>Eje X:</strong> Días desde la siembra</li>
            <li><strong>Eje Y:</strong> Índice de producción (tallos/plantas)</li>
            <li><strong>Puntos:</strong> Valores registrados en cada corte</li>
            <li><strong>Línea vertical verde:</strong> Fin del ciclo vegetativo</li>
            <li><strong>Línea vertical roja:</strong> Fin del ciclo total</li>
        </ul>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    
    <!-- Contenedor para el componente React -->
    <div id="curva-produccion-container" data-variedad-id="{{ variedad.variedad_id }}" data-api-url="{{ api_url }}"></div>
</div>
{% endblock %}

{% block scripts %}
<!-- Incluir React y ReactDOM -->
<script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>
<!-- Recharts para las gráficas -->
<script src="https://unpkg.com/recharts@2.1.12/umd/Recharts.min.js" crossorigin></script>

<!-- Script para renderizar el componente -->
<script src="{{ url_for('static', filename='js/dist/CurvaProduccion.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('curva-produccion-container');
        const variedadId = container.dataset.variedadId;
        const apiUrl = container.dataset.apiUrl;
        
        // Renderizar el componente React
        ReactDOM.render(
            React.createElement(CurvaProduccion, {
                variedadId: variedadId,
                apiUrl: apiUrl
            }),
            container
        );
    });
</script>
{% endblock %}